{"ast":null,"code":"import { createAsyncThunk } from '@reduxjs/toolkit';\nimport { loadOffers, requireAuthorization, setError } from './action';\nimport { AuthorizationStatus, TIMEOUT_SHOW_ERROR } from '../const';\nimport { dropToken, saveToken } from '../services/token';\nimport { store } from '.';\nexport const fetchOfferAction = createAsyncThunk('loadOffers', async (_arg, _ref) => {\n  let {\n    dispatch,\n    extra: api\n  } = _ref;\n  dispatch(setQuestionsDataLoadingStatus(true));\n  const {\n    data\n  } = await api.get('/hotels');\n  dispatch(loadOffers(data));\n});\nexport const checkAuthAction = createAsyncThunk('checkAuth', async (_arg, _ref2) => {\n  let {\n    dispatch,\n    extra: api\n  } = _ref2;\n  try {\n    await api.get('/login');\n    dispatch(requireAuthorization(AuthorizationStatus.Auth));\n  } catch {\n    dispatch(requireAuthorization(AuthorizationStatus.NoAuth));\n  }\n});\nexport const loginAction = createAsyncThunk('user/login', async (_ref3, _ref4) => {\n  let {\n    login: email,\n    password\n  } = _ref3;\n  let {\n    dispatch,\n    extra: api\n  } = _ref4;\n  const {\n    data: {\n      token\n    }\n  } = await api.post('/login', {\n    email,\n    password\n  });\n  saveToken(token);\n  dispatch(requireAuthorization(AuthorizationStatus.Auth));\n});\nexport const logoutAction = createAsyncThunk('user/logout', async (_arg, _ref5) => {\n  let {\n    dispatch,\n    extra: api\n  } = _ref5;\n  await api.delete('/logout');\n  dropToken();\n  dispatch(requireAuthorization(AuthorizationStatus.NoAuth));\n});\nexport const clearErrorAction = createAsyncThunk('clearError', () => {\n  setTimeout(() => store.dispatch(setError(null)), TIMEOUT_SHOW_ERROR);\n});","map":{"version":3,"names":["createAsyncThunk","loadOffers","requireAuthorization","setError","AuthorizationStatus","TIMEOUT_SHOW_ERROR","dropToken","saveToken","store","fetchOfferAction","_arg","_ref","dispatch","extra","api","setQuestionsDataLoadingStatus","data","get","checkAuthAction","_ref2","Auth","NoAuth","loginAction","_ref3","_ref4","login","email","password","token","post","logoutAction","_ref5","delete","clearErrorAction","setTimeout"],"sources":["C:/Users/Cody/Documents/GitHub/2205815-six-cities-simple-12/project/src/store/api-actions.ts"],"sourcesContent":["import { createAsyncThunk } from '@reduxjs/toolkit';\r\nimport { AxiosInstance } from 'axios';\r\nimport { AppDispatch, State } from '../types/state';\r\nimport { Offers } from '../types/offers';\r\nimport { loadOffers, requireAuthorization, setError, setOffersDataLoadingStatus } from './action';\r\nimport { AuthorizationStatus, TIMEOUT_SHOW_ERROR } from '../const';\r\nimport { dropToken, saveToken } from '../services/token';\r\nimport { AuthData } from '../types/auth-data';\r\nimport { UserData } from '../types/use-data';\r\nimport { store } from '.';\r\n\r\nexport const fetchOfferAction = createAsyncThunk<void, undefined, {\r\n    dispatch: AppDispatch;\r\n    state: State;\r\n    extra: AxiosInstance;\r\n  }>(\r\n    'loadOffers',\r\n    async (_arg, {dispatch, extra: api}) => {\r\n      dispatch(setQuestionsDataLoadingStatus(true));\r\n      const {data} = await api.get<Offers>('/hotels');\r\n      dispatch(loadOffers(data));\r\n    },\r\n  );\r\n\r\nexport const checkAuthAction = createAsyncThunk<void, undefined, {\r\n    dispatch: AppDispatch;\r\n    state: State;\r\n    extra: AxiosInstance;\r\n  }>(\r\n    'checkAuth',\r\n    async (_arg, {dispatch, extra: api}) => {\r\n      try {\r\n        await api.get('/login');\r\n        dispatch(requireAuthorization(AuthorizationStatus.Auth));\r\n      } catch {\r\n        dispatch(requireAuthorization(AuthorizationStatus.NoAuth));\r\n      }\r\n    },\r\n  );\r\n\r\n\r\nexport const loginAction = createAsyncThunk<void, AuthData, {\r\n    dispatch: AppDispatch;\r\n    state: State;\r\n    extra: AxiosInstance;\r\n  }>(\r\n    'user/login',\r\n    async ({login: email, password}, {dispatch, extra: api}) => {\r\n      const {data: {token}} = await api.post<UserData>('/login', {email, password});\r\n      saveToken(token);\r\n      dispatch(requireAuthorization(AuthorizationStatus.Auth));\r\n    },\r\n  );\r\n\r\nexport const logoutAction = createAsyncThunk<void, undefined, {\r\n    dispatch: AppDispatch;\r\n    state: State;\r\n    extra: AxiosInstance;\r\n  }>(\r\n    'user/logout',\r\n    async (_arg, {dispatch, extra: api}) => {\r\n      await api.delete('/logout');\r\n      dropToken();\r\n      dispatch(requireAuthorization(AuthorizationStatus.NoAuth));\r\n    },\r\n  );\r\n\r\nexport const clearErrorAction = createAsyncThunk(\r\n  'clearError',\r\n  () => {\r\n    setTimeout(\r\n      () => store.dispatch(setError(null)),\r\n      TIMEOUT_SHOW_ERROR,\r\n    );\r\n  },\r\n);\r\n"],"mappings":"AAAA,SAASA,gBAAgB,QAAQ,kBAAkB;AAInD,SAASC,UAAU,EAAEC,oBAAoB,EAAEC,QAAQ,QAAoC,UAAU;AACjG,SAASC,mBAAmB,EAAEC,kBAAkB,QAAQ,UAAU;AAClE,SAASC,SAAS,EAAEC,SAAS,QAAQ,mBAAmB;AAGxD,SAASC,KAAK,QAAQ,GAAG;AAEzB,OAAO,MAAMC,gBAAgB,GAAGT,gBAAgB,CAK5C,YAAY,EACZ,OAAOU,IAAI,EAAAC,IAAA,KAA6B;EAAA,IAA3B;IAACC,QAAQ;IAAEC,KAAK,EAAEC;EAAG,CAAC,GAAAH,IAAA;EACjCC,QAAQ,CAACG,6BAA6B,CAAC,IAAI,CAAC,CAAC;EAC7C,MAAM;IAACC;EAAI,CAAC,GAAG,MAAMF,GAAG,CAACG,GAAG,CAAS,SAAS,CAAC;EAC/CL,QAAQ,CAACX,UAAU,CAACe,IAAI,CAAC,CAAC;AAC5B,CAAC,CACF;AAEH,OAAO,MAAME,eAAe,GAAGlB,gBAAgB,CAK3C,WAAW,EACX,OAAOU,IAAI,EAAAS,KAAA,KAA6B;EAAA,IAA3B;IAACP,QAAQ;IAAEC,KAAK,EAAEC;EAAG,CAAC,GAAAK,KAAA;EACjC,IAAI;IACF,MAAML,GAAG,CAACG,GAAG,CAAC,QAAQ,CAAC;IACvBL,QAAQ,CAACV,oBAAoB,CAACE,mBAAmB,CAACgB,IAAI,CAAC,CAAC;EAC1D,CAAC,CAAC,MAAM;IACNR,QAAQ,CAACV,oBAAoB,CAACE,mBAAmB,CAACiB,MAAM,CAAC,CAAC;EAC5D;AACF,CAAC,CACF;AAGH,OAAO,MAAMC,WAAW,GAAGtB,gBAAgB,CAKvC,YAAY,EACZ,OAAAuB,KAAA,EAAAC,KAAA,KAA4D;EAAA,IAArD;IAACC,KAAK,EAAEC,KAAK;IAAEC;EAAQ,CAAC,GAAAJ,KAAA;EAAA,IAAE;IAACX,QAAQ;IAAEC,KAAK,EAAEC;EAAG,CAAC,GAAAU,KAAA;EACrD,MAAM;IAACR,IAAI,EAAE;MAACY;IAAK;EAAC,CAAC,GAAG,MAAMd,GAAG,CAACe,IAAI,CAAW,QAAQ,EAAE;IAACH,KAAK;IAAEC;EAAQ,CAAC,CAAC;EAC7EpB,SAAS,CAACqB,KAAK,CAAC;EAChBhB,QAAQ,CAACV,oBAAoB,CAACE,mBAAmB,CAACgB,IAAI,CAAC,CAAC;AAC1D,CAAC,CACF;AAEH,OAAO,MAAMU,YAAY,GAAG9B,gBAAgB,CAKxC,aAAa,EACb,OAAOU,IAAI,EAAAqB,KAAA,KAA6B;EAAA,IAA3B;IAACnB,QAAQ;IAAEC,KAAK,EAAEC;EAAG,CAAC,GAAAiB,KAAA;EACjC,MAAMjB,GAAG,CAACkB,MAAM,CAAC,SAAS,CAAC;EAC3B1B,SAAS,EAAE;EACXM,QAAQ,CAACV,oBAAoB,CAACE,mBAAmB,CAACiB,MAAM,CAAC,CAAC;AAC5D,CAAC,CACF;AAEH,OAAO,MAAMY,gBAAgB,GAAGjC,gBAAgB,CAC9C,YAAY,EACZ,MAAM;EACJkC,UAAU,CACR,MAAM1B,KAAK,CAACI,QAAQ,CAACT,QAAQ,CAAC,IAAI,CAAC,CAAC,EACpCE,kBAAkB,CACnB;AACH,CAAC,CACF"},"metadata":{},"sourceType":"module","externalDependencies":[]}